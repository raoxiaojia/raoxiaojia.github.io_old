\documentclass[a4paper]{article}

\input{temp}

\setcounter{section}{-1}

\begin{document}

\title{Introduction to Approximate Groups}

\maketitle

\newpage

\tableofcontents

\newpage

\section{Introduction}

---Lecture 1--- 

Example classes: 12 Feb, 5 Mar, 2-3pm.\\
Venue will be confirmed later.\\
Examinable material is exactly what is on board (as usual).\\
No plan for printed notes (as usual).

After 3.5 years of tripos, we finally know what a subgroup is: a \emph{subgroup} $H<G$ is a non-empty set closed under products and inverses.\\
We would then expect an \emph{approximate subgroup} to be a subset that is only \emph{approximately} closed under products. We'll make this precise soon. Such sets arise naturally in a number of branches of maths, and as such approximate groups have had broad range of applications. In this course we'll look in detail, for example, at applications to polynomial growth (fundamental in geometric group theory), and touch on construction of expander(?) graphs (important in theoretical CS).\footnote{Lecturer actually spent the time to write all this on board, probably implying a slower-paced course than category theory! But every course is slower than category theory.}

\newpage

\section{Small Doubling}
To start with, we'll look at a preliminary notion of approximate closure called \emph{small doubling}.\\
In this course, $G$ is always a group, arbitrary unless specified otherwise. Given $A,B \subset G$, we write 
$$AB=\{ab:a \in A, b \in B\}$$
called the product set,
$$A^n = \underbrace{A \cdot ... \cdot A}_{n\text{ times}}$$
$$A^{-1} = \{a^{-1}:a \in A\}$$
$$A^{-r} = (A^{-1})^n$$

When $G$ is abelian, we often switch to additive notion, for example $A+B, nA, -A,-nA$ in place of the above (\emph{sum sets}).\\
To say $A$ is \emph{closed} is to say $A^2 = A$.\\
If $A$ is finite, one way to say that $A$ is \emph{approximately closed} is to say that $|A^2|$ is \emph{not much bigger} than $|A|$. This is the notion of approximate closure that arises when studying polynomial growth or expansion, for example.

To get a feel for what this should mean, let's look at the possible values of $|A^2|$. Trivially we have $|A| \leq |A^2| \leq |A|^2$, and both bounds are attained. However, although the quadratic upper bound on $|A^2|$ in terms of $|A|$ is extremal in a strict sense, it should not be seen as atypical for the size of $A^2$.\footnote{We will see in sheet 1 that random $A$ have quadratic size for $|A^2|$, in the sense of: if $A$ is a set of size $n$ chosen uniformly at random from $\{1,...,n^{100}\}$ (we'd like to choose from all integers, but there's no uniform measure there), then $\E(|A+A|)$ is \emph{closed to} $\frac{1}{2} |A|^2$. Note that this is the largest we can get, since in an abelian group we have $a+b=b+a$.} Therefore, we can view sets $A$ satisfying
$$|A^2| = o(|A|^2)\ \ \ (1.1)$$
as being \emph{exceptional}, and so condition (1.1) can already be seen as a form of \emph{approximate closure}. In this course, we will concentrate on the strongest form of (1.1), where $|A^2|$ is \emph{linear} in $|A|$, in the sense that
$$|A^2| \leq K|A|\ \ \ (1.2)$$
for some constant $K \geq 1$ fixed a priori.\\
Obviously, such sets are very far from random, and we can expect (1.2) to impose a significant restriction on $A$. The main aim of the course is to work out how significant the restriction is.

\begin{defi} (Small doubling)\\
Given $A \subset G$, the ratio $|A^2| / |A|$ is called the \emph{doubling constant}.\\
If $A$ satisfies (1.2), we'll say that $A$ has \emph{doubling} at most $K$, or simply \emph{small doubling}.\\
\end{defi}

\begin{eg}
$\bullet$ $A$ a finite subgroup;\\
$\bullet$ $|A| \leq K$;\\
$\bullet$ $A \subset \Z, A = \{-n,...,n\}$, $|A+A|\leq 2|A|$.\\

This last example is especially important as it shows that the theory does not just reduce to subgroups and small sets. We'll develop these examples later in the course.
\end{eg}

Our main aim will be to prove theorems along the lines of: if $A$ has small doubling, then $A$ has a certain structure. When $K$ is very small, this is quite easy, as follows.

\begin{thm} (1.1, Freiman\footnote{The proof presented here is by Tao instead of the original version. Lecturer has no way to tell if the original proof is close to this, especially because the original proof is in Russian.})\\
Let $K< \frac{3}{2}$. Suppose $A \subset G$ and $|A^2| \leq K|A|$ (by writing like this, we're obviously assuming $A$ is finite). Then there is a subgroup $H<G$ with $|H| = |A^2|$ ($\leq K|A|$) such that $A \subset aH = Ha \forall a \in A$.\\
(i.e., $A$ is a large portion of a coset of a finite subgroup).
\end{thm}

\begin{rem}
Converse: if $A \subset xH = Hx$ for $x \in G$, $H<G$, $|H| \leq K|A|$, then $|H^2| \leq K|A|$. So this is a complete classsification of sets of very small doubling.
\end{rem}

\begin{lemma} (1.2, identify $H$)\\
If $|A^2| < \frac{3}{2}|A|$, then $H=A^{-1}A$ is a subgroup. Moreover, $A^{-1}A = AA^{-1}$, and $|H| < 2|A|$.
\begin{proof}
Let $a,b \in A$. The hypothesis gives $|aA \cap bA| > \frac{1}{2} |A|$, so there are $> \frac{1}{2}|A|$ pairs of $(x,y) \in A \times A$ s.t. $ax = by$, i.e. $a^{-1}b=xy^{-1}$. This immediately implies $A^{-1}A \subset AA^{-1}$ (as we just needed one such pair $(x,y)$), and replacing $A$ by $A^{-1}$ we get the other inclusion; so $A^{-1}A = AA^{-1}$ as required.

Since $|A \times A| = |A|^2$, it also implies that $|A^{-1}A| \leq \frac{|A|^2}{\frac{1}{2}|A|} = 2|A|$, as claimed. Note also that $A^{-1}A$ is symmetric, so it remains to show that $A^{-1}A$ is closed under products.\\
Let $c,d \in A$. As above, there exist $>\frac{1}{2}|A|$ pairs $(u,v) \in A \times A$ s.t. $c^{-1} d = uv^{-1}$. This means for at least one pair $(x,y)$ and one pair $(u,v)$, we have $y=u$. In particular, $a^{-1}bc^{-1}d = xv^{-1} \in AA^{-1} = A^{-1}A$.
\end{proof}
\end{lemma}

\begin{lemma} (1.3, size bound)\\
If $|A^2| < \frac{3}{2} |A|$, then $A^2 = aHa$ $\forall a \in A$ ($H$ as before). In particlar, $|H| = |A^2|$.
\begin{proof}
First, note that $A \subset aH \cap Ha$ (label this 1.3) by definition of $H$ and $A^{-1}A = AA^{-1}$, so certainly $A^2 \subset aHa$. For the reverse inclusion, let $z \in aHa$. Since $H$ is a subgroup, there exists $|H|$ pairs $(x,y) \in aH \times Ha$ s.t. $z=xy$. Moreover, by (1.3) and the bound $|H| < 2|A|$ from lemma (1.2), more than half of those $x$ and half of those $y$ belong to $A$. In particular, this means that for at least one pair $(x,y)$, both have to belong to $A$. Hence $z=xy \in A^2$ as required.
\end{proof}
\end{lemma}

Proof of theorem (1.1):
\begin{proof}
Given $a \in A$, we have $Aa^{-1} \subset aHa^{-1} \cap H$, so $|aHa^{-1} \cap H| \geq |A| > \frac{1}{2}|H|$ by lemma (1.2). But the only subgroup of $H$ of size $>\frac{1}{2}|H|$ is $H$ itself. Hence $aHa^{-1} = H$, so indeed $A \subset aH = Ha$ by (1.3).
\end{proof}

Classifying the sets of small doubling is much harder than this in general, and uses a much wider range of techniques e.g. group theory, harmonic analysis, geometry of numbers, etc.

\newpage 

\section{Covering and Higher Sum and Product Sets}

---Lecture 2---

Today we will introduce two techniques we'll use repeatedly: \emph{covering}, and \emph{bounding higher product sets}. A nice way to do this is by proving the following theorem.

\begin{thm} (2.1, Rusza)\\
    Suppose $A \subseteq \F^r_p$ satisfies $|A+A| \leq K|A|$. Then there is a subgroup $H \subseteq \F_p^r$ with $|H| \leq p^{K^4}K^2 |A|$ s.t. $A \subseteq H$.
\end{thm}

\begin{rem}
    It's not ideal that $|A|/|H|$ depends on $p$. We'll remove this dependency in a few lectures' time.
\end{rem}

We'll start by proving the following weaker version:

\begin{prop} (2.2)\\
    Suppose $A \subseteq \F_p^r$ satisfies $|2A-2A| \leq K|A|$. Then there is a subgroup $H \subseteq \F_p^r$ with $|H| \leq p^K |A-A|$ ($\leq p^K K|A|$) such that $A \subseteq H$.
\end{prop}

We'll prove this using 'covering', encapsulated by the following lemma:

\begin{lemma} (2.3, Rusza's Covering Lemma)\\
    Suppose $A,B \subseteq G$, and $|AB| \leq K|B|$. Then, $\exists X \subseteq A$ with $|X| \leq K$ s.t. $A \subseteq XBB^{-1}$. Indeed, we may take $X \subseteq A$ maximal such that the sets $xB$ ($x \in X$) are disjoint.\\
    The term \emph{covering} refers to the conclusion $A \subseteq XBB^{-1}$, which says \emph{$A$ can be covered by  few left-translates of $BB^{-1}$.}
    \begin{proof}
        First, disjointness of $xB \implies |XB| = |X||B|$. Since $X \subseteq A$, $|XB| \leq |AB| \leq K|B|$, so $|X| \leq K$. Maximality implies $\forall a \in A$, $\exists x \in X$ s.t. $aB \cap xB \neq \phi$; and hence $a \in xBB^{-1}$. So $A \subseteq XBB^{-1}$.
    \end{proof}
\end{lemma}

Now we prove some lemmas for proposition 2.2:

\begin{lemma} (2.4)\\
    Suppose $A \subseteq G$ satisfies $|A^{-1}A^2A^{-1}| \leq K|A|$. Then $\exists X \subseteq A^{-1} A^2$, $|X| \leq K$ such that $A^{-1} A^n \subseteq x^{n-1} A^{-1}A \forall n \in \N$.
    \begin{proof}
        Lemma 2.3 gives (as $|A| = |A^{-1}|$) the existence of an $X \subseteq A^{-1} A^2$, $|X| \leq K$ s.t. $A^{-1}A^2 \subseteq XA^{-1}A$. We then have
        \[
            A^{-1} A^n &= A^{-1} A^{n-1} A\\
            &\subseteq X^{n-2} A^{-1} A^2 \text{ by induction}\\
            &\subseteq X^{n-1} A^{-1} A
        \]
    \end{proof}
\end{lemma}

\begin{proof} (of proposition 2.2)\\
    Note that $\F_p^r$ is abelian, so we can apply Lemma 2.4 which gives the existence of $X$, $|X| \leq K$ s.t. $nA - A \subseteq (n-1)X+A-A \forall n \in \N$. As we are in a finite vector space, this means that $\bra A \ket \subseteq \bra X \ket +A-A$, so $|\bra A\ket| \leq |\bra X \ket| |A-A| \leq p^K K|A|$, as claimed.
\end{proof}

To strenghthen prop 2.2 to theorem 2.1, we use the technique of bounding higher sum/product sets. The key result, at least in the abelian case, is the following:

\begin{thm} (2.5, Pl\"{u}necke-Rusza)\\
    Suppose $A \subseteq G$ (abelian) and $|A+A| \leq K|A|$, then $|mA-nA| \leq K^{m+n} |A|$ $\forall m,n \geq 0$.\\
    This was proven intro to discrete analysis last term. We won't redo the whole proof, but we will reprove some parts of it.
\end{thm}

\begin{proof}
    2.5 gives that $|2A-2A| \leq K^4 |A|$, and $|A-A| \leq K^2|A|$. Then immediately it follows from prop 2.2.
\end{proof}

We'll spend the rest of teh lecture discussing theorem 2.5 and variants of it. We've seen that it is useful, at least in one context. To see more properly why it's useful, let's think about what the genuine closure of subgroups under products and inverse means. One useful feature is that it can be iterated: given $h_1,h_2,... \in H$, a subgroup, this means that $h_1^{\varepsilon_1}...h_m^{\varepsilon_m} \in H$ $\forall \varepsilon_i = \pm 1$ $\forall m \forall h_i \in H$. Then theorem 2.5 allows us to \emph{iterate the approximate closure} of a set of small doubling: $a_1+...+a_m-a_1'-...-a_n'$ may not belong to $A$, but at least belongs to $mA-nA$ which is (a) not too large, and (b) itself a set of small doubling ($|2(mA-nA)| \leq K^{2m-2n} |mA-nA|$). This is an important part of why the theory works so well.\\
It is therefore unfortunate that theorem 2.5 doesn't hold for non-abelian groups.

\begin{eg} (2.6)\\
    Let $x$ generate an infinite cyclic group $\bra x \ket$, and $H$ be a finite group. Set $G=H *\bra x\ket$, the free product (just keep in mind that $x^{-1} Hx \neq H$). Set $A = H \cup \{x\}$, then $A^2 = H \cup xH \cup Hx \cup \{x^2\}$, so $|A^2| \leq 3|A|$. But $A^3$ contains $HxH$, which has size $|H|^2 \sim |A|^2$. So as $|H| \to \infty$, theorem 2.5 cannot hold.
\end{eg}

Nonetheless, if we strenghten small doubling slightly, we can recover a form of theorem 2.5. One way is to replace it with \emph{small tripling}, i.e. $|A^3| \leq K|A|$:

\begin{prop} (2.7)\\
    Suppose $A \subseteq G$, $|A^3| \leq K|A|$. Then $|A^{\varepsilon_1} ... A^{\varepsilon_m}| \leq K^{3(m-2)} |A|$, $\forall \varepsilon_i =\pm 1, \forall m \geq 3$.
\end{prop}

The key ingredient is the following:

\begin{lemma} (2.8, Rusza's Triangle Inequality)\\
    Given $U,V,W \subseteq G$ all finite, $|U| |V^{-1} W| \leq |UV||UW|$.
    \begin{proof}
        We'll define an injection $\varphi:U \times V^{-1} W \to UV \times UW$. First, for $x \in V^{-1} W$, set $V(x) \in V$, and $W(x) \in W$, s.t. $x=V(x)^{-1} W(x)$. Set $\varphi(u,x) = (uV(x),uW(x))$. To see injectivity, first note that $(uV(x))^{-1} (uW(x)) = x$, so $x$ is determined by $\varphi(u,x)$, then $(uV(x))(v(x)^{-1}) = u$, so $u$ is also determined by $\varphi(u,x)$.
    \end{proof}
\end{lemma}

\begin{proof} (of 2.7)\\
    First, we'll do the case $m=3$.\\
    $\bullet$ $|A^3| = |A^{-3}| \leq K|A|$;\\
    $\bullet$ apply lemma 2.8 with $U=W=A$, $V=A^2$. Get $|A||A^{-2}A|\leq |A^3| |A^2| \leq K^2|A|^2$, so $|S^{-2}A| \leq K^2 |A|$;
    $\bullet$ note that $(A^{-2}A)^{-1} = (A^{-1}A^2)$, so $|A^{-1}A^2||A^{-2}A| \leq K^2|A|$;\\
    $\bullet$ replace $A$ by $A{-1}$ to get $|AA^{-2}| = |A^2 A^{-1}| \leq K^2|A|$;\\
    $\bullet$ Finally, apply lemma 2.8 with $U=V=A, W=AA^{-1}$, we get $|A||A^{-1}AA^{-1}| \leq |A^2||A^2 A^{-1}| \leq K^3 |A|^2$. So, $|A^{-1} AA^{-1}| \leq K^3 |A|$. For the last case, swap $A \leftrightarrow A^{-1}$.

    For $m \geq 4$, lemma 2.8 gives $|A||A^{\varepsilon_1} ... A^{\varepsilon_m}| \leq |AA^{-\varepsilon_2} A^{-\varepsilon_1}| |AA^{\varepsilon_3}...A^{\varepsilon_m}| \leq K^3|A| K^{3(m-3)}|A|$ by induction.
\end{proof}

\newpage

\section{Approximate groups}

---Lecture 3---

Last time we saw that assuming small tripling instead of small doubling allowed us to control higher product sets of the form $A^{\varepsilon_1}...A^{\varepsilon_m}$. In this lecture, we'll see another possible strengthening of small doubling. We also saw, in the proofs of theorem 2.1 and proposition 2.2, that the advantage of having a \emph{covering} condition in place of a size bound. This motivates the following definition:

\begin{defi} (Approximate groups)\\
A set $A \subset G$ is called a \emph{$K$-approximate group} (or $K$-approximate subgroup) if $1 \in A$, $A^{-1} = A$, and $\exists X \subset G$ $|X| \leq K$ s.t. $A^2 \subset XA$.
\end{defi}

Note that $A$ need not be finite, although in this course it almost always will be. Also, if $A$ is finite, then $|A^2| \leq K|A|$.\\
The conditions $1 \in A$ and $A^{-1} = A$ are convenient notationally: for example, we can write $A^m$ in stead of $A^{\varepsilon_1}...A^{\varepsilon_m}$, and $1 \in A \implies A \subset A^2 \subset A^3 \subset ...$, which is also convenient at times. It's the condition $A^2 \subset XA$ that is most important.

For approximate groups, bounding higher product sets is easy:

\begin{lemma} (3.1)\\
If $A$ is a finite $K$-approximate group, then $|A^m| \leq K^{m-1} |A|$.
\begin{proof}
If $X$ is as in definition of approximate group, in fact we have $A^m \subset X^{m-1}A$:
\[
A^m &= A^{m-1}A\\
&\subset X^{m-2} A^2 \text{ induction}\\
&\subset X^{m-1}A \text{ definition of X}
\]
\end{proof}
\end{lemma}

Another advantage is that if $\pi: G \to H$ is a homomorphism and $A$ is a $K$-approximate group, then $\pi(A)$ is also trivially a $K$-approximate group (although we'll see that there exists a version of this for small tripling).\\
It turns out that sets of small tripling and approximate groups are essentially equivalent, in the following sense:

\begin{prop} (3.2)\\
Let $A \subset G$ be finite. If $A$ is a $K$-approximate group then $|A^3| \leq K^2 |A|$. Conversely, if $|A^3| \leq K|A|$ then there exists $O(K^{12})$-approximate groups $B$ with $A \subset B$ and $|B| \leq 7K^3 |A|$ (\emph{$A$ is a large proportion of an approximate group}). In fact, we may take $B=(A \cup \{1 \} \cup A^{-1})^2$.
\begin{proof}
First part is just lemma 3.1. For the converse, set $\hat{A} = A \cup \{1\} \cup A^{-1}$, and note that $A^2 = \{1\} \cup A \cup A^{-1} \cup A^2 \cup A^{-1}A \cup AA^{-1} \cup A^{-2}$. Each set in this union has size $\leq K^2|A|$, by prop 2.7, so $|B| \leq 7K^3|A|$, as claimed. Similarly,
\[
A^4 = \bigcup_{\varepsilon_i = \pm 1, 0 \leq m \leq 4} A^{\varepsilon_1}...A^{\varepsilon_m}
\]
and the sets in this union have size $\leq K^6|A|$. It follows that $|\hat{A}^4| \leq O(K^6) |\hat{A}|$. Lemma 2.4 then tells us that $\exists X \subset G$, $|X| \leq O(K^6)$ s.t. $\hat{A}^n \subset X^{n-2} \hat{A}^2$ for every $n \geq 2$.\\
In particular, $|X^2| \leq O(K^{12})$, and $\hat{A}^4 = (\hat{A}^2)^2 \subset X^2 \hat{A}^2$, so $\hat{A}^2$ is an $O(K^{12})$-approximate group, as claimed.
\end{proof}
\end{prop}

This is all well and good, but what if we are faced with a set like that from example 2.6, which only has small doubling (but not tripling)? In that specific example, a large proportion of $A$ was a set of small tripling, namely $H$. Rather helpfully, that turns out to be a general phenomenon:

\begin{thm} (3.3)\\
If $A \subset G$ satisfies $|A^2| \leq K|A|$, then $\exists U \subset A$ with $|U| \geq \frac{1}{K}|A|$ s.t. $|U^m| \leq K^{m-1} |U|$ $\forall m \in \N$.
\end{thm}

So small doubling reduces to small tripling, which reduces to approximate groups. In sheet 1 we'll see a direct reduction from small doubling to approximate groups.

Tao proved a version of theorem 3.3 when he introduced the definition of approximate groups. We'll use instead a lemma of Petridis, which he proved when proving the Pl\"{u}nnecke-Ruzsa inequalities.

\begin{lemma} (3.4, Petridis)\\
Suppose $A,B \subset G$ are finite, let $U \subset A$ be non-empty, chosen to minimise the ratio $|UB| / |U|$, and write $R=|UB|/|U|$. Then for every finite $C \subset G$, we have $|CUB| \leq R|CU|$.
\begin{proof}
It's trivial if $C=\phi$, so we may assume $\exists x \in C$. Defining $C' = C \{x\}$, we may also assume by induction that $|C'UB| \leq R|C'U|$.\\
Set $W = \{u \in U: xu \in C'U\}$. Then $CU=C'U \cup (xU \setminus xW)$ is a disjoint union, so in particular 
\[
|CU| = |C'U| + |U|-|W| \ \text{ (3.1)}
\]
We also have $xWB \subset C'UB$ by definition of $W$, so $CUB \subset C'UB \cup (xUB \setminus xWB)$, and hence
\[
|CUB| &\leq |C'UB|+|UB|-|WB|\  \text{ (3.2)}
\]
We have $|C'UB| \leq R|C'U|$ by induction hypothesis, we have $|UB|=R|U|$ by definition oF $R$, and $|WB| \geq R|W|$ by minimality in the definition of $U$. So 
\[
|CUB| &\leq R(|C'U| + |U| - |W|) \text{ by (3.2)}\\
&= R|CU| \text{ by (3.1)}
\]
\end{proof}
\end{lemma}

\begin{proof} (of 3.3)\\
Set $U \subset A$ to be non-empty, minimizing $|UA| / |U|$, and write $R=|UA|/|U|$, noting that $R \leq K$ by minimality (since $U$ must have beaten $A$). Also, $U$ non-empty implies $|UA| \geq |A|$, so $|U| \geq \frac{|A|}{K}$, as required. Lemma 2.4 also implies that $|U^mA| \leq K|U^m| \forall m$ (taking $C=U^{m-1}$, and since $U \subset A$, this gives $|U^{m+1}| \leq K|U^m| \forall m$, so $|U^m| \leq K^{m-1} |U|$.
\end{proof}

Non-examinable: the reason $A$ in example 2.6 failed to have small tripling was the existence of $x \in A$ with $AxA$ large. It turns out that this is the only obstruction to small doubling having small tripling.

\begin{thm} (3.5, Tao, Petridis)\\
If $|A^2| \leq K|A|$, and $|AxA| \leq K|A|$ $\forall x \in A$, then $|A^m| \leq K^{O(m)}|A|$ $\forall m \geq 3$.
\end{thm}

Also non-examinable (it's in intro to DA, but lecturer thought it's was showing):

\begin{thm} (2.5')\\
After writing a few words, lecturer decided that there's not enough time, and we have written enough this lecture, so wiped everything out from the board.
\end{thm}

Check example sheets at $tointon.neocities.org$; they'll be up some time this afternoon.

\newpage

\section{Stability of approximate closure under basic operations}

---Lecture 4---

There's a misprint in sheet 1 q7, but it has been corrected last friday.

Two familiar properties of genuine subgroups are that they behave well under quotients and intersections:\\
$\bullet$ if $H<G$, and $\pi:G \to \Gamma$ is a homomorphism, then $\pi(H) < \Gamma$;\\
$\bullet$ if $H_1,H_2 < G$, then $H_1 \cap H_2 < G$.

In this lecture we'll see versions of these properties for approximate groups and sets of small tripling.

It's trivial that if $A \subset G$ is a $K$=approximate group, then $\pi(A)$ is also a $K$-approximate group. The following is the corresponding result for sets of small tripling.

\begin{prop} (4.1, stability of small tripling under homomorphisms)\\
Let $A \subset G$ be finite, symmetric, containing the identity. Suppose $\pi:G \to \Gamma$ is a homomorphism. Then 
\[
\frac{|\pi(A)^m|}{|\pi(A)} \leq \frac{|A^{m+2}|}{|A|}
\]
for all $m \in \N$.\\
In particular, if $|A^3| \leq K|A|$, then $|\pi(A)^3| \leq K^9|\pi(A)|$ by proposition 2.7.
\end{prop}

We'll prove this using an argument of Helfgolt. We'll start with a simple observation that we'll use repeatedly in the course.

\begin{lemma} (4.2)\\
Let $H < G$, let $A \subset G$ be finite, and let $x \in G$. Then $|A^{-1}A \cap H| > |A \cap xH|$.
\begin{proof}
We have $(A \cap xH)^{-1} (A \cap xH) \subset A^{-1} A \cap H$.
\end{proof}
\end{lemma}

\begin{rem}
Most of the lemmas and propositions in this lecture will have familiar/trivial analogues for genuine subgroups.
\end{rem}

\begin{lemma} (4.3)\\
Let $H < G$, write $\pi:G \to G/H$ for the quotient map, let $A \subset G$ be finite.\\
Then $|A^{-1}A \cap H| \geq |A|/|\pi(A)|$.\\
Note that $H$ is not assumed normal, so $G/H$ is just the \emph{space} of left cosets of $xH$, not necessarily a group.
\begin{proof}
By pigeonhole principle there exists $x \in G$ s.t. $|A \cap xH| \geq |A|/|\pi(A)|$. Then apply lemma (4.2).
\end{proof}
\end{lemma}

\begin{lemma} (4.4)\\
Let $H < G$, write $\pi:G \to G/H$ for the quotient map, and let $A \subset G$ be finite.\\
Then $|\pi(A^m)||A^n \cap H| \leq |A^{m+n}| \forall m,n \geq 0$.
\begin{proof}
Define $\varphi:\pi(A^m) \to A^m$ by picking arbitrarily for each $x \in \pi(A^m)$, some $\varphi(x)$ s.t. $\pi(\varphi(x)) = x$. Then the cosets of $\varphi(x) H$ for $x \in \pi(A^m)$ are all distinct by definition, so in particular,
\[
|\varphi(\pi(A^m)) (A^n \cap H)| = |\pi(A^m)| |A^n \cap H|
\]
But also, $\varphi(\pi(A^m)) (A^n \cap H) \subset A^{m+n}$.
\end{proof}
\end{lemma}

\begin{proof} (of 4.1)\\
Write $H=\ker \pi$. Lemma (4.4) gives $|\pi(A^m)| \leq \frac{|A^{m+2}|}{|A^2 \cap H|}$. Lemma 4.3 gives $|A^2 \cap H| \geq |A| / |\pi(A)|$ (?). The proposition follows from combining these two inequalities.
\end{proof}

Now we'll look at intersections:

\begin{prop} (4.5, stability of small tripling under intersections with subgroups)\\
Let $A \subset G$ be finite, symmetric, containing 1. Let $H \leq G$. Then
\[
\frac{|A^m \cap H|}{|A^2 \cap H|} \leq \frac{|A^{m+1}|}{|A|}
\]
In particular, by prop 2.7, if $|A^3| \leq K|A|$, then 
\[
|(A^m \cap H)^3| \leq K^{9m} |A^m \cap H|
\]
$\forall m \geq 2$.
\begin{rem}
We'll see in example sheet 1 that even if $A$ has small tripling, $A \cap H$ need not. So $m \geq 2$ is really important for this last conclusion.
\end{rem}
\begin{proof}
Lemma 4.4 gives $|A^m \cap H| \leq |A^{m+1}| / |\pi(A)|$, where $\pi:G \to G/H$ is the quotient map as before).\\
Lemma 4.3 gives $|A^2 \cap H| \geq |A| / |\pi(A)|$.\\
The proposition follows from combining these two inequalities.
\end{proof}
\end{prop}

\begin{prop} (4.6, stability of approximate groups under intersections with subgroups)\\
Let $H < G$, let $A \subset G$ be a $K$-approximate group. Then $A^m \cap H$ is covered by $\leq K^{m-1}$ left-translates of $A^2 \cap H$.\\
In particular, $A^m \cap H$ is a $K^{2m-1}$-approximate group (since $A^2 \cap H \subset A^m \cap H$ and $(A^m \cap H)^2 \subset A^{2m} \cap H$).
\begin{proof}
By definition, $\exists X \subset G$ with $|X| = K^{m-1}$ s.t. $A^m \subset XA$. In particular, $A^m \cap H \subset \cup_{x \in X} (xA \cap H)$.\\
For each $xA \cap H$ non-empty, $\exists h = xa \in H$ for some $a \in A$. this means that $xA \cap H \subset h(a^{-1} A \cap H) \subset h(A^2 \cap H)$.\\
Hence each set $xA \cap H$ in this union is contained in a single left translate of $A^2 \cap H$.
\end{proof}
\end{prop}

In intro to discrete analysis last term, you saw that when studying small doubling/tripling, there is a more general notion of homomorphism that comes into play -- the Freiman homomorphism. To motivate this, consider two sets $A=\{-n,...,n\} \subset \Z/p\Z$, and $B = \{-n,...,n\} \subset \Z/q\Z$ for $p,q$ two large primes $\geq 10n$, say. These two sets are intuitively \emph{isomorphic} from perspective of $A+A$, or $B+B$, but there is no way of encoding this with a group homomorphism $\Z/p\Z \to \Z/q\Z$.

\begin{defi} (Freiman homomorphism)\\
Let $m \in \N$, let $A,B$ be subsets of groups. Then a map $\varphi:A \to B$ is a \emph{Freiman $m$-homomorphism} if for $x_1,...,x_m,y_1,...,y_m \in A$ with $x_1...x_m = y_1...y_m$, we have $\varphi(x_1)...\varphi(x_m) = \varphi(y_1)...\varphi(y_m)$.\\
If $1 \in A$ and $\varphi(1) = 1$, then we say that $\varphi$ is \emph{centred}. If $\varphi$ is injective, and its inverse $\varphi(A) \to A$ is also a Freiman $m$-homomorphism, then we say $\varphi:A \to \varphi(A)$ is a \emph{Freiman $m$-isomorphism}.
\end{defi}

\begin{rem}
1) Every map is trivially a $1$-homomorphism, so we only care about $m \geq 2$.\\
2) This notion gets stronger as $m$ increases: we may assume $A \neq \phi$, and then, picking $a \in A$ arbitrarily, if $x_1...x_k = y_1...y_k$ for $k \leq m$, then 
\[
x_1...x_k \underbrace{a...a}_{m-k} = y_1...y_k \underbrace{a...a}_{m-k}
\]
3) If $\varphi$ is centred and $a,a^{-1} \in A$, then exercise to check $\varphi(a^{-1}) = \varphi(a)^{-1}$ ($m \geq 2$). When we say $\varphi$ is a Freiman homomorphism, we mean it is a $2$-homomorphism.
\end{rem}

\begin{lemma} (4.7)\\
Suppose $\varphi:A \to \Gamma$ is a Freiman $m$-homomorphism. Then $|\varphi(A)^m| \leq |A^m|$.\\
In particular, if $\varphi$ is injective, then
\[
\frac{|\varphi(A)^m|}{|\varphi(A)|} \leq \frac{|A^m|}{|A|}
\]
and if $\varphi$ is a Freiman $m$-isomorphism, then equality holds.
\end{lemma}
\begin{proof}
Exercise.
\end{proof}

---Lecture 5---

\begin{lemma} (4.8)\\
Let $A \subset G$ be a $K$-approximate group, suppose $\varphi:A^3 \to \Gamma$ is a centred ($1 \in A$ and $\varphi(1) = 1$) Freiman 2-homomorphism. Then $\varphi(A)$ is also a $K$-approximate group.
\begin{proof}
$\exists X \subset G$, $|X| \leq K$ s.t. $A^2 \subset XA$. So given $a_1,a_2 \in A$, $\exists x \in X, a_3 \in A$ s.t. $a_1a_2 = xa_3$. In particular, $x \in A^3$, so $\varphi(x)$ is defined; and $\varphi(a_1)\varphi(a_2) = \varphi(x) \varphi(a_3)$.\\
Hence $\varphi(A)^2 \subset \varphi(X \cap A^3) \varphi(A)$.\\
Also, $\varphi$ is centred, so $\varphi(A)$ is symmetric and contains 1.
\end{proof}
\end{lemma}

\newpage

\section{Coset progressions, Bohr sets and the Freiman-Green-Ruzsa theorem}
Today we will introduce some non-trivial examples of sets of small doubling in abelian groups.

\begin{defi} (coset progression)\\
Let $G$ be abelian, $x_1,...,x_r \in G$, $L_1,...,L_r \in \N$. Then the set
\[
P(x;L) = P(x_1,...,x_r;L_1,...,L_r) = \{l_1x_1+...+l_rx_r : |l_i| \leq L_i  \forall i\}
\]
is called a \emph{progression of rank $r$}. If in addition $H \subset G$ is finite, then $H+P(x;L)$ is called a \emph{coset progression} of rank $r$.
\end{defi}

It is useful to think of $P(x;L)$ as a homomorphic image of a \emph{box} in $\Z^r$. For example, if $G=\Z$ and $r=2$:\\
(diagram)

It's easy to see that such a box $B$ in $\Z^r$ is a $2^r$-approximaate group, e.g. in $r=2$:\\
(diagram)

Hence $P(x;L)$ is also a $2^r$-approximate group, as is $H_P(r;L)$.

Remarkably, these are essentially the only examples:

\begin{thm} (5.1, Frieman ($G=\Z$); Green-Rusza (arbitrary abelian $G$))\\
Suppose $A \subset G$ (abelian) satisfies $|A+A| \leq K|A|$. Then there exists a coset progression $H+P$ of rank $\leq O(K^{O(1)})$ s.t. $A \subset H+P \subset O(K^{O(1)})(A \cup \{0\} \cup -A)$.\\
In particular, theorem 2.5 gives that $|H+P| \leq \exp(O(K^{O(1)})) |A|$. So $A$ is a large proportion of $H+P$.
\end{thm}

A substantial part of this result was proved in intro to discrete analysis, but with a slightly less explicit version of coset progressions:

\begin{defi} (Bohr set)\\
Let $G$ be a finite abelian group. Let $\Gamma = \{\gamma_1,...,\gamma_r\} \subset \hat{G} = Hom(G,\R/\Z)$, and let $\rho \in [0,\frac{1}{2}]$. Then the set
\[
B(\Gamma,\rho) = \{g \in G: || \gamma_i(g)||_{\R/\Z} \leq \rho \forall i \}
\]
is called a Bohr set of rank $r$. Here, given $x \in \R/\Z$ with representative $\hat{x} \in (-\frac{1}{2},\frac{1}{2}]$, we write $||x||_{\R/\Z} = |\hat{x}|$.
\end{defi}

We'll see in sheet 1 that $B(\Gamma,\rho)$ is a $4^r$-approximate group, whereas progressions were homomorphic images of boxes, $B(\Gamma,\rho)$ is the pullback(??) of $[-\rho,\rho]^r$ under $(\gamma_1,...,\gamma_r) = \hat{G}^r$.

It turns out that the notions of coset progression and Bohr set are essentially equivalent. In sheet 2, we'll see that every coset progression is a Freimana image of a Bohr set of the same rank. Moreover, every Freiman image of a Bohr set is a large proportion of some coset progression. We'll see a special case of that shortly.

\begin{prop} (5.2, from intro to DA)\\
Suppose $A \subset G$ (abelian) with $|A+A| \leq K|A|$. Then $\exists B \subset 2A-2A$ a finite abelian group $Z$ with $|Z| \geq |A|$, a set $\Gamma \subset \hat{Z}$ with $|\Gamma| \leq O(K^{O(1)})$, some $\rho \geq \frac{1}{O(K^{O(1)})}$, and a centred Freiman 2-isomorphism $\varphi:B(\Gamma,\rho) \to B$.\\
(\emph{$2A-2A$ contains a large set isomorphic to a Bohr set of bounded rank}).\\
In intro to DA you saw this in the special case of $G$ torsion-free. The general case is harder, but nonetheless conceptually very similar, so we'll assume this result from now on.
\end{prop}

To pass from prop 5.2 to theorem 5.1, we use the following results:

\begin{prop} (5.3)\\
Suppose $Z$ is a finite abelian group, $\Gamma \subset \hat{Z}$ is of size $r$, $\rho<\frac{1}{10}$\footnote{Lecturer thinks he might also get away with a larger choice.}. Then there exists a coset progression $H+P \subset B(\Gamma,\rho)$ with rank $r$ and $|H+P| \geq (\rho/r)^r |Z|$.
\end{prop}

We'll prove prop 5.3 in the next couple of lectures.

\begin{lemma} (5.4)\\
Suppose $H+P$ is a coset progression of rank $r$, and $\varphi:H+P \to G$ (abelian) is a centred Freiman 2-homomorphism. Then $\varphi(H_P)$ is also a coset progression of rank $r$.
\begin{proof}
Exercise: if $H$ is a group and $\varphi:H \subset G$ is a centred Freiman 2-homomorphism, then $\varphi$ is also a group homomorphism. In particular, in this lemma, $\varphi(H)$ is a finite subgroup. Therefore it's sufficient to show that $\varphi(H+P(x;L)) = \varphi(H) + P(\varphi(x_1),...,\varphi(x_r);L_1,...,L_r)$.\\
In fact, we'll show that $\forall h \in H$, $|l_i| \leq L_i$, we have 
\[
\varphi(h+l_1x_1+...+l_rx_r) = \varphi(h) + l_1 \varphi(x_1)+...+l_r \varphi(x_r) \ \text{(5.1)}
\]
Since $\varphi$ is centred, $\varphi(-x_i) = -\varphi(x_i)$, so we may assume that $l_i \geq 0 \forall i$. Also, (5.1) is trivial if $l_i = 0 \forall i$, so we may also assume that $\exists l_j > 0$. Then
\[
\varphi(h+l_1x_1+...+l_rx_r) &= \varphi(h+l_1x_1+...+l_rx_2)+\varphi(0)\\
&= \varphi(h+l_1x_1+...+(l_j-1) x_j + ... + l_r x_r) + \varphi(x_j)
\]
So lemma follows by induction on $\sum_i l_i$.
\end{proof}
\end{lemma}

\begin{proof} (of theorem 5.1)\\
By proposition 5.2 and 5.3 and lemma 5.4, $\exists H+P$ coset progression of rank $\leq O(K^{O(1)})$ s.t. $H+P \subset 2A-2A$ and $|H+P| \geq \exp(-O(K^{O(1)}))|A|$.\\
We'll now apply a version of Ruzsa's covering lemma due to Chang. Define recursively sets $S_1,S_2,... \subset A$ s.t. $S_i$ is a maximal subset of size $\leq 2K$ s.t. the translates $x+S_{i-1} + ... + S_1 + H + P$ are all disjoint. If ever $|S_i| < 2K$, we stop. Now suppose we get as far as $S_1,...,S_t$. Then
\[
S_t+...+S_1 + H+P \subset 2A-2A+tA
\]
So prop 2.5 $\implies$ $|S_t+...+S_1+H+P| \leq K^{4+t} |A|$.\\
On the other hand, disjointness of the translates in the definition of $S_i$ means that 
\[
|S_t+...+S_1 + H+P| \geq |S_t|...|S_1||H+P| \geq (2K)^{t-1} \exp(-O(K^{O(1)})) |A|
\]
Putting these together, we have $2^{t-1} \leq K^5 \exp(O(K^{O(1)}))$, hence $t \leq O(K^{O(1)})$.\\
In particular, the process terminates, at $S_t$ say.\\
But also, since $S_t$ is therefore maximal among all subsets of $A$ s.t. $x+S_{t-1} + ... +S_1 + H+P$ are disjoint for $x \in S_t$, Ruzsa's covering lemma from lecture 2 implies that
\[
A \subset H+2P +S_1-S_1 + ... + S_{t-1}-S_{t-1} + S_t
\]
Enumerating $\bigcup_i S_i$ as $s_1,...,s_d$, we have $d \leq O(K^{O(1)})$, and 
\[
A \subset H + 2P + P(s_1,...,s_d;1,...,1) \subset O(K^{O(1)})(A \cup\{0\} \cup -A)
\]
as claimed (subject to proving 5.3).
\end{proof}

Exercise: see what bounds you get if you apply Ruzsa's covering lemma directly, instead of Chang's argument.

---Lecture 6 lost due to technical failure---

\end{document}
